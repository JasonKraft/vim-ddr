<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 2</title>
    <script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

var LeftArrows;
var DownArrows;
var UpArrows;
var RightArrows;
var score = 0;
var scoreText;
var killzone;

var songSpeed = -125;

var song;

function preload() {

    game.load.image('arrowUp', 'assets/UpArrow.png');
    game.load.image('arrowDown', 'assets/DownArrow.png');
    game.load.image('arrowLeft', 'assets/LeftArrow.png');
    game.load.image('arrowRight', 'assets/RightArrow.png');
    game.load.image('background', 'assets/BG.png');
    game.load.image('killzone', 'assets/Killzone.png');

    game.load.audio('song1', ['assets/harder_better_faster_stronger.mp3', 'assets/harder_better_faster_stronger.ogg'])
}

function create() {
    song = game.sound.play('song1');
    
    game.physics.startSystem(Phaser.Physics.ARCADE);

    game.add.sprite(0,0,'background');

    killzone = game.add.sprite(0, -32, 'killzone');
    game.physics.arcade.enable(killzone);

    LeftArrows = game.add.group();
    LeftArrows.enableBody = true;

    DownArrows = game.add.group();
    DownArrows.enableBody = true;

    UpArrows = game.add.group();
    UpArrows.enableBody = true;

    RightArrows = game.add.group();
    RightArrows.enableBody = true;

    scoreText = game.add.text(4, 4, 'Score: 0', { fontSize: '32px', fill: '#000' });


    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.H);
    tempKey.onDown.add(HPress);

    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.J);
    tempKey.onDown.add(JPress);

    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.K);
    tempKey.onDown.add(KPress);

    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.L);
    tempKey.onDown.add(LPress);

    //game.time.events.loop(Phaser.Timer.SECOND, updateCounter, this);
    game.time.events.add(Phaser.Timer.SECOND * 0.25, function(){createArrow('left')}, this);
    game.time.events.add(Phaser.Timer.SECOND * 0.5, function(){createArrow('down')}, this);
    game.time.events.add(Phaser.Timer.SECOND * 0.75, function(){createArrow('up')}, this);
    game.time.events.add(Phaser.Timer.SECOND * 1, function(){createArrow('right')}, this);

}
function HPress(){
    LeftArrows.forEach(function(arrow){
        if(arrow.alive){
            if(arrow.y<200 && arrow.y>100){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
            }
        }
    }, this);
}

function JPress(){
    DownArrows.forEach(function(arrow){
        if(arrow.alive){
            if(arrow.y<200 && arrow.y>100){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
            }
        }
    }, this);
}

function KPress(){
    UpArrows.forEach(function(arrow){
        if(arrow.alive){
            if(arrow.y<200 && arrow.y>100){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
            }
        }
    }, this);
}

function LPress(){
    RightArrows.forEach(function(arrow){
        if(arrow.alive){
            if(arrow.y<200 && arrow.y>100){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
            }
        }
    }, this);
}

/*function updateCounter(){

    createArrow('left');
    createArrow('up');
    createArrow('down');
    createArrow('right');

}*/

function createArrow(direction){
    switch(direction){
        case 'left':
            //creates left arrow
            var newArrow = LeftArrows.create(game.world.width /4, game.world.height+ 32, 'arrowLeft');
            newArrow.scale.setTo(.5,.5);
            newArrow.body.velocity.y = -125;
            newArrow.body.velocity.y = songSpeed;
            break;
        case 'down':
        //creates down arrow
        var newArrow = DownArrows.create(game.world.width /4 + 64, game.world.height+ 32, 'arrowDown');
            newArrow.scale.setTo(.5,.5);
            newArrow.body.velocity.y = -125;
            newArrow.body.velocity.y = songSpeed;
            break;
        case 'up':
            //creates up arrow
            var newArrow = UpArrows.create(game.world.width /4 + 128, game.world.height+ 32, 'arrowUp');
            newArrow.scale.setTo(.5,.5);
            newArrow.body.velocity.y = -125;
            newArrow.body.velocity.y = songSpeed;
            break;
        case 'right':
            //creates right arrow
            var newArrow = RightArrows.create(game.world.width /4 + 192, game.world.height+ 32, 'arrowRight');
            newArrow.scale.setTo(.5,.5);
            newArrow.body.velocity.y = -125;
            newArrow.body.velocity.y = songSpeed;
            break;
    }
}

function update() {
    game.physics.arcade.overlap(killzone, LeftArrows, destroyArrow, null, this);
    game.physics.arcade.overlap(killzone, UpArrows, destroyArrow, null, this);
    game.physics.arcade.overlap(killzone, DownArrows, destroyArrow, null, this);
    game.physics.arcade.overlap(killzone, RightArrows, destroyArrow, null, this);

}

function destroyArrow (killzone, arrow) {
    arrow.destroy();
    score -= 5;
    scoreText.text = 'Score: ' + score;
}


</script>

</body>
</html>