//temp object until they give  us real ones
/*var songData = {
    songName : "Harder Better Faster Stronger",
    url : "assets/harder_better_faster_stronger",
    difficulty : "EZPZ",
    data : [
    { arrow : "3", time : 200 },
    { arrow : "3", time : 1000 },
    { arrow : "10", time : 2000 }
    ]
};*/

var songData = {
    songName : "Harder Better Faster Stronger",
    url : "assets/harder_better_faster_stronger",
    difficulty : "EZPZ",
    data : [[1,5950],
[1,6177],
[1,6367],
[2,7036],
[4,7253],
[2,7631],
[4,7861],
[2,8776],
[4,8958],
[4,9298],
[4,9726],
[4,9927],
[4,10144],
[1,11111],
[8,11537],
[2,11947],
[4,12156],
[1,12594],
[4,13006],
[4,13406],
[4,13610],
[2,14006],
[4,14450],
[8,15545],
[1,15552],
[2,16114],
[4,16119],
[1,16723],
[8,16726],
[2,18138],
[4,18360],
[8,18558],
[2,19236],
[2,19642],
[2,19828],
[4,20309],
[4,20467],
[4,20861],
[4,21059],
[2,22098],
[8,22310],
[4,22917],
[1,23315],
[2,23552],
[1,24361],
[4,24365],
[8,24765],
[2,24778],
[1,25177],
[8,25185],
[8,25392],
[1,25399],
[4,25855],
[2,26110],
[4,26304],
[4,26883],
[4,27071],
[4,27494],
[4,27682],
[1,28440],
[1,28685],
[2,29165],
[4,29389],
[8,29755],
[4,30073],
[2,31397],
[4,31631],
[8,31847],
[8,32494],
[8,32682],
[8,32878],
[8,33085],
[4,33472],
[2,33694],
[4,33924],
[2,34298],
[4,35967],
[1,35976],
[4,36151],
[1,36161],
[1,36328],
[4,36334],
[8,36728],
[2,36733],
[4,37166],
[1,37192],
[8,37565],
[2,37578],
[4,38161],
[4,38423],
[2,38996],
[8,40004],
[2,40274],
[8,40506],
[4,40957],
[2,41583],
[4,41790],
[8,42005],
[8,42450],
[4,42650],
[2,43025],
[1,43203],
[2,44604],
[4,44818],
[2,45032],
[8,45646],
[8,45861],
[8,46083],
[8,46295],
[4,46745],
[8,47123],
[4,47601],
[4,48180],
[2,49164],
[4,49365],
[8,49769],
[8,50019],
[4,50504],
[2,50881],
[1,51877],
[4,51879],
[8,52126],
[2,52144],
[8,52540],
[2,52548],
[1,52945],
[4,52950],
[8,53292],
[2,53310],
[1,53687],
[8,53693],
[8,54165],
[1,54175],
[1,55167],
[2,55170],
[4,55716],
[2,55722],
[8,56364],
[4,56377],
[2,57198],
[4,57426],
[2,57621],
[4,57832],
[2,58264],
[1,58883],
[4,59088],
[2,59292],
[4,59506],
[8,59962],
[4,60700],
[2,61154],
[2,63062],
[4,63304],
[2,63756],
[4,63976],
[4,67226],
[4,67447],
[4,67657],
[4,67858],
[4,68335],
[4,68540],
[4,68910],
[4,69108],
[2,70147],
[4,70943],
[2,71404],
[4,71601],
[8,72354],
[2,72810],
[4,73199],
[1,73406],
[2,74255],
[2,74496],
[4,74935],
[4,75118],
[4,75486],
[4,75682],
[2,76486],
[4,76703],
[4,77107],
[2,77328],
[1,77784],
[2,77973],
[2,79449],
[4,79626],
[8,79819],
[2,80565],
[2,80736],
[2,80921],
[2,81526],
[2,81721],
[2,82114],
[2,82319],
[4,82688],
[2,82913],
[8,83117],
[2,83496],
[2,83833],
[2,84197],
[2,84394],
[2,84597],
[4,85594],
[1,86035],
[2,86393],
[2,86631],
[4,87060],
[2,87278],
[4,87491],
[1,88068],
[2,88255],
[4,88738],
[2,88943],
[2,89712],
[8,89723],
[8,89945],
[2,89963],
[4,90380],
[1,90381],
[4,90590],
[1,90596],
[8,91004],
[2,91009],
[8,91225],
[2,91230],
[2,92664],
[4,92848],
[8,93069],
[8,93708],
[8,93889],
[8,94115],
[8,94325],
[2,94736],
[4,94930],
[2,95172],
[4,95549],
[1,97176],
[2,97366],
[4,97573],
[8,97782],
[4,98028],
[2,98390],
[4,98799],
[1,99223],
[4,99262],
[4,99415],
[1,99458],
[8,99676],
[2,99690],
[4,100229],
[2,101307],
[2,101542],
[2,101763],
[2,102195],
[4,102758],
[4,102988],
[4,103212],
[1,103593],
[1,103825],
[2,104229],
[4,104436],
[2,105902],
[4,106103],
[8,106311],
[8,106917],
[8,107101],
[8,107334],
[8,107539],
[2,107955],
[4,108371],
[1,108818],
[1,109417],
[2,110436],
[4,110596],
[8,110805],
[8,111008],
[8,111236],
[8,111621],
[1,111661],
[8,112055],
[1,112090],
[1,113115],
[2,113121],
[2,113337],
[1,113345],
[4,113764],
[2,113769],
[8,114153],
[1,114219],
[8,114511],
[1,114521],
[8,114921],
[1,114926],
[2,115375],
[4,115377],
[2,116481],
[4,117036],
[1,117709],
[1,117902],
[2,118390],
[4,118745],
[2,118946],
[4,119120],
[2,119505],
[1,120190],
[4,120384],
[1,120608],
[4,120792],
[1,121253],
[1,125090],
[2,125570],
[2,126378],
[1,126967],
[1,127379],
[2,128463],
[1,128857],
[2,129712],
[1,130322],
[1,130702],
[2,131804],
[1,132213],
[2,133008],
[1,133637],
[1,134052],
[2,135018],
[1,135463],
[2,136328],
[1,136962],
[1,137321],
[2,138332],
[1,138750],
[2,139641],
[1,140217],
[1,140750],
[2,141628],
[1,142092],
[2,142898],
[1,143559],
[1,143983],
[2,144562],
[1,145225],
[2,146253],
[2,147355],
[2,147943],
[2,148736],
[2,149567],
[2,150898],
[2,151302],
[2,151898],
[2,152881],
[2,154166],
[2,154561],
[2,155198],
[2,156200],
[4,156802],
[4,157254],
[2,157884],
[4,158463],
[4,158838],
[8,159307],
[8,160596],
[8,161179],
[4,161812],
[2,162315],
[4,162499],
[8,162684],
[2,163243],
[2,163624],
[2,163796],
[2,164252],
[4,164453],
[2,164643],
[4,164825],
[4,165088],
[2,166710],
[2,166903],
[2,167101],
[2,167301],
[4,167561],
[4,167992],
[4,168437],
[2,168731],
[4,168940],
[2,169170],
[2,169759],
[2,170846],
[2,171031],
[2,171346],
[2,171769],
[2,172342],
[2,172570],
[2,172759],
[2,173186],
[4,173403],
[4,173774],
[8,173967],
[2,175371],
[4,175578],
[8,175776],
[8,176388],
[2,176648],
[2,176844],
[2,177032],
[4,177470],
[2,177909],
[4,178386],
[4,178992],
[2,180014],
[2,180197],
[2,180386],
[2,180585],
[2,180769],
[2,181125],
[2,181608],
[4,182601],
[1,182610],
[4,182843],
[1,182853],
[4,183285],
[1,183290],
[8,183690],
[2,183700],
[1,184057],
[4,184067],
[8,184476],
[2,184514],
[8,184907],
[2,184913],
[2,185976],
[4,186588],
[8,187149],
[2,188045],
[4,188275],
[8,188467],
[8,188640],
[8,189063],
[2,189640],
[4,189832],
[8,190049],
[2,190855],
[4,191389],
[2,191624],
[4,191808],
]
}


/////////////////
//PreBoot state//
/////////////////

var PrebootState = {

    preload:function() {
        this.load.spritesheet('load', 'assets/LoadScreen.png', 800, 600);
    },
    create:function() {
        this.state.start('PreloadState');
    },

}

/////////////////
//Preload state//
/////////////////

var PreloadState = {
    preload: function() {

        this.load = this.add.sprite(0, 0, 'load');
        this.load.animations.add('loading', [0,1,2,3,4,5], 12, true);
        this.load.animations.play('loading');

        this.add.text(game.width/2-50, game.height-40, 'Loading...', { fill: '#0c493b', font: '20pt New' })

        //load image assets
        game.load.image('arrowUp', 'assets/UpArrow.png');
        game.load.image('arrowDown', 'assets/DownArrow.png');
        game.load.image('arrowLeft', 'assets/LeftArrow.png');
        game.load.image('arrowRight', 'assets/RightArrow.png');
        game.load.image('background', 'assets/Background.png');
        game.load.image('killzone', 'assets/Killzone.png');

        game.load.spritesheet('upOutline','assets/UpArrow_outline.png', 98, 96);
        game.load.spritesheet('rightOutline','assets/RightArrow_outline.png', 96, 98);
        game.load.spritesheet('downOutline','assets/DownArrow_outline.png', 98, 96);
        game.load.spritesheet('leftOutline','assets/LeftArrow_outline.png', 96, 98);

        //load audio assets
        game.load.audio('song1', [songData.url + '.ogg', songData.url + '.mp3']);
    },

    update:function(){
        if (this.cache.isSoundDecoded('song1'))
        {
            this.state.start('GameState');
        }
    }
}

//////////////
//Game State//
//////////////

var GameState = { preload: preload, create: create, update: update };

var game = new Phaser.Game(800, 600, Phaser.AUTO, '');
game.state.add('PrebootState', PrebootState);
game.state.add('PreloadState', PreloadState);
game.state.add('GameState', GameState);
game.state.start('PrebootState');

var LeftArrows;
var DownArrows;
var UpArrows;
var RightArrows;
var score = 0;
var scoreText;
var killzone;

var songSpeed = -200;

var song;

function preload() {

    
}

function create() {
    //start playing the song
    song = game.sound.play('song1');

    //set up the physics
    game.physics.startSystem(Phaser.Physics.ARCADE);

    //add in the background
    game.add.sprite(0,0,'background');

    //set up the zone to destroy outstanding arrows
    killzone = game.add.sprite(0, -65, 'killzone');
    game.physics.arcade.enable(killzone);

    //adding outlines to the canvas
    outlines = game.add.group();
    outlines.enableBody = true;
    leftOutline = outlines.create(150, 15, 'leftOutline');
    leftOutline.scale.setTo(.75,.75);
    downOutline = outlines.create(293, 15, 'downOutline');
    downOutline.scale.setTo(.75,.75);
    upOutline = outlines.create(436, 15, 'upOutline');
    upOutline.scale.setTo(.75,.75);
    rightOutline = outlines.create(581, 15, 'rightOutline');
    rightOutline.scale.setTo(.75,.75);

    //creating respective groups for the different arrows
    LeftArrows = game.add.group();
    LeftArrows.enableBody = true;

    DownArrows = game.add.group();
    DownArrows.enableBody = true;

    UpArrows = game.add.group();
    UpArrows.enableBody = true;

    RightArrows = game.add.group();
    RightArrows.enableBody = true;

    scoreText = game.add.text(10, game.world.height-40, 'Score: 0', { fontSize: '32px', fill: '#e9f6fd', font: '32pt New' });


    //creating key press events for H,J,K,L
    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.H);
    tempKey.onDown.add(HPress);
    tempKey.onUp.add(HUnpress);

    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.J);
    tempKey.onDown.add(JPress);
    tempKey.onUp.add(JUnpress);

    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.K);
    tempKey.onDown.add(KPress);
    tempKey.onUp.add(KUnpress);

    var tempKey = game.input.keyboard.addKey(Phaser.Keyboard.L);
    tempKey.onDown.add(LPress);
    tempKey.onUp.add(LUnpress);

    var timeDif = (game.world.height - 17) / songSpeed;

    //set timers for all the arrows given for the song
    /*for(var i = 0; i < songData.data.length; i++){
        if(songData.data[i].arrow & 8){
            game.time.events.add(songData.data[i].time, createLeft, this);
        }
        if(songData.data[i].arrow & 4){
            game.time.events.add(songData.data[i].time, createDown, this);
        }
        if(songData.data[i].arrow & 2){
            game.time.events.add(songData.data[i].time, createUp, this);
        }
        if(songData.data[i].arrow & 1){
            game.time.events.add(songData.data[i].time, createRight, this);
        }
    }*/

    for(var i = 0; i < songData.data.length; i++){
        if(songData.data[i][0] & 8){
            game.time.events.add(songData.data[i][1] - timeDif , createLeft, this);
        }
        if(songData.data[i][0] & 4){
            game.time.events.add(songData.data[i][1] - timeDif, createDown, this);
        }
        if(songData.data[i][0] & 2){
            game.time.events.add(songData.data[i][1] - timeDif, createUp, this);
        }
        if(songData.data[i][0] & 1){
            game.time.events.add(songData.data[i][1] - timeDif, createRight, this);
        }
    }

}
function HPress(){
    var foundArrow = 0;
    LeftArrows.forEachAlive(function(arrow){
        if(foundArrow===0){
            //max points
            if(Math.abs(arrow.y-15)/15>0 && Math.abs(arrow.y-15)/15<=.6){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(0);
                outline = outlines.create(150, 15, 'leftOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //medium points
            else if(Math.abs(arrow.y-15)/15>.6 && Math.abs(arrow.y-15)/15<=1.2){
                score += 4;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(0);
                outline = outlines.create(150, 15, 'leftOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //min points
            else if(Math.abs(arrow.y-15)/15>1.2 && Math.abs(arrow.y-15)/15<=2.5){
                score += 2;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(0);
                outline = outlines.create(150, 15, 'leftOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
        }
    }, this);
    if(foundArrow == 0){
        score -= 1;
        scoreText.text = 'Score: ' + score;
    }
}

function JPress(){
    var foundArrow = 0;
    DownArrows.forEachAlive(function(arrow){
        if(foundArrow===0){
            //max points
            if(Math.abs(arrow.y-15)/15>0 && Math.abs(arrow.y-15)/15<=.6){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(1);
                outline = outlines.create(293, 15, 'downOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //medium points
            else if(Math.abs(arrow.y-15)/15>.6 && Math.abs(arrow.y-15)/15<=1.2){
                score += 4;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(1);
                outline = outlines.create(293, 15, 'downOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //min points
            else if(Math.abs(arrow.y-15)/15>1.2 && Math.abs(arrow.y-15)/15<=2.5){
                score += 2;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(1);
                outline = outlines.create(293, 15, 'downOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
        }
    }, this);
    if(foundArrow == 0){
        score -= 1;
        scoreText.text = 'Score: ' + score;
    }
}

function KPress(){
    var foundArrow = 0;
    UpArrows.forEachAlive(function(arrow){
        if(foundArrow===0){
            //max points
            if(Math.abs(arrow.y-15)/15>0 && Math.abs(arrow.y-15)/15<=.6){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(2);
                outline = outlines.create(436, 15, 'upOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //medium points
            else if(Math.abs(arrow.y-15)/15>.6 && Math.abs(arrow.y-15)/15<=1.2){
                score += 4;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(2);
                outline = outlines.create(436, 15, 'upOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //min points
            else if(Math.abs(arrow.y-15)/15>1.2 && Math.abs(arrow.y-15)/15<=2.5){
                score += 2;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(2);
                outline = outlines.create(436, 15, 'upOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
        }
    }, this);
    if(foundArrow == 0){
        score -= 1;
        scoreText.text = 'Score: ' + score;
    }
}

function LPress(){
    var foundArrow = 0;
    RightArrows.forEachAlive(function(arrow){
        if(foundArrow===0){
            //max points
            if(Math.abs(arrow.y-15)/15>0 && Math.abs(arrow.y-15)/15<=.6){
                score += 7;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(3);
                outline = outlines.create(581, 15, 'rightOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //medium points
            else if(Math.abs(arrow.y-15)/15>.6 && Math.abs(arrow.y-15)/15<=1.2){
                score += 4;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(3);
                outline = outlines.create(581, 15, 'rightOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
            //min points
            else if(Math.abs(arrow.y-15)/15>1.2 && Math.abs(arrow.y-15)/15<=2.5){
                score += 2;
                scoreText.text = 'Score: ' + score;
                arrow.kill();
                foundArrow = 1;

                //getting arrow outline to change color
                outline = outlines.getChildAt(3);
                outline = outlines.create(581, 15, 'rightOutlineGlow');
                outline.scale.setTo(.75,.75);
            }
        }
    }, this);
    if(foundArrow == 0){
        score -= 1;
        scoreText.text = 'Score: ' + score;
    }
}

function HUnpress(){
    //getting arrow outline to change color
    outline = outlines.getChildAt(0);
    outline.frame = 0;
    outline.scale.setTo(.75,.75);
}

function JUnpress(){
    //getting arrow outline to change color
    outline = outlines.getChildAt(1);
    outline.frame = 0;
    outline.scale.setTo(.75,.75);
}

function KUnpress(){
    //getting arrow outline to change color
    outline = outlines.getChildAt(2);
    outline.frame = 0;
    outline.scale.setTo(.75,.75);
}

function LUnpress(){
    //getting arrow outline to change color
    outline = outlines.getChildAt(3);
    outline.frame = 0;
    outline.scale.setTo(.75,.75);
}

function createLeft(){
    var newArrow = LeftArrows.create(155, game.world.height+ 32, 'arrowLeft');
    newArrow.scale.setTo(.65,.65);
    newArrow.body.velocity.y = songSpeed;
}

function createDown(){
    var newArrow = DownArrows.create(298, game.world.height+ 32, 'arrowDown');
    newArrow.scale.setTo(.65,.65);
    newArrow.body.velocity.y = songSpeed;
}

function createUp(){
    var newArrow = UpArrows.create(441, game.world.height+ 32, 'arrowUp');
    newArrow.scale.setTo(.65,.65);
    newArrow.body.velocity.y = songSpeed;
}

function createRight(){
    var newArrow = RightArrows.create(586, game.world.height+ 32, 'arrowRight');
    newArrow.scale.setTo(.65,.65);
    newArrow.body.velocity.y = songSpeed;
}

function update() {
    game.physics.arcade.overlap(killzone, LeftArrows, destroyArrow, null, this);
    game.physics.arcade.overlap(killzone, UpArrows, destroyArrow, null, this);
    game.physics.arcade.overlap(killzone, DownArrows, destroyArrow, null, this);
    game.physics.arcade.overlap(killzone, RightArrows, destroyArrow, null, this);

}

function destroyArrow (killzone, arrow) {
    arrow.destroy();
    score -= 5;
    scoreText.text = 'Score: ' + score;
}